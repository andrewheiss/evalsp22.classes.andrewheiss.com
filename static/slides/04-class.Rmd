---
title: "Class 4: Logic models and DAGs"
author: "Andrew Heiss"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    lib_dir: "libs"
    chakra: "libs/remark-latest.min.js"
    css: ["default", "css/ath-slides.css", "css/ath-inferno-fonts.css", "css/animate.css"]
    seal: false
    anchor_sections: false
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: "16:9"
      navigation:
        scroll: false
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, 
                      fig.retina = 3, fig.align = "center")
```

```{r packages-data, include=FALSE}
library(tidyverse)
library(ggdag)
library(palmerpenguins)
library(modelsummary)
```

```{r xaringanExtra, echo=FALSE}
xaringanExtra::use_xaringan_extra(c("tile_view"))
```

class: center middle main-title section-title-3

# In-person<br>session 4

.class-info[

**September 13, 2021**

.light[PMAP 8521: Program evaluation<br>
Andrew Young School of Policy Studies
]

]

---

name: outline
class: title title-inv-8

# Plan for today

--

.box-2.medium.sp-after-half[How to read a regression table]

--

.box-4.medium.sp-after-half[Miscellaneous R things]

--

.box-1.medium.sp-after-half[Logic models]

--

.box-5.medium.sp-after-half[DAGs]

---

layout: false
name: regression-table
class: center middle section-title section-title-5 animated fadeIn

# How to read<br>a regression table

---

```{r echo=FALSE, warning=FALSE}
model1 <- lm(body_mass_g ~ bill_length_mm, data = penguins)
model2 <- lm(body_mass_g ~ flipper_length_mm, data = penguins)
model3 <- lm(body_mass_g ~ bill_length_mm + flipper_length_mm, data = penguins)
model4 <- lm(body_mass_g ~ bill_length_mm + flipper_length_mm + sex, data = penguins)

modelsummary(list(model1, model2, model3, model4),
             table.attr = "style=\'font-size:0.5em;\'",
             stars = TRUE,
             output = "kableExtra")
```

---

```{r echo=FALSE}
modelsummary(list(model1, model2, model3, model4),
             stars = TRUE,
             output = "kableExtra")
```

---

class: middle

.box-5.large[See full documentation and<br>examples for `modelsummary()` [here](https://vincentarelbundock.github.io/modelsummary/articles/modelsummary.html)]

---

layout: false
name: r-stuff
class: center middle section-title section-title-4 animated fadeIn

# R stuff

---

layout: true
class: middle

---

.box-4.large[Make nicer tables when<br>knitting with `kable()`]

.box-inv-4[(Or even fancier tables with [kableExtra](https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html)!)]

---

.box-4.large[Navigating larger R Markdown files]

---

.box-4.large[Figure resizing]

---

.box-4.large[It's okay to remove placeholder text!]

---

.box-4.large[R vs. Python]

---

layout: false
name: logic-models
class: center middle section-title section-title-1 animated fadeIn

# Logic models

---

layout: true
class: middle

---

.box-1.large[Logic models as managerial tools]

---

.box-1.large[Inputs vs. Activities vs.<br>Outputs vs. Outcomes]

---

.box-1.large[Impact theory vs. logic model]

---

layout: false
class: title title-1

# Impact theory

.box-inv-1[Ensure that the theory linking activities to the outcomes is sound!]

.center[
<figure>
  <img src="img/03/psd-impact-theory-arrow.png" alt="PSD impact theory" title="PSD impact theory" width="100%">
</figure>
]

---

.center[
<figure>
  <img src="img/01/psd-logic-model.png" alt="PSD logic model" title="PSD logic model" width="70%">
</figure>
]

---

layout: false
class: title title-1

# MPA/MPP at GSU

.pull-left[
<figure>
  <img src="img/03/mpp-mission@4x.png" alt="MPP mission" title="MPP mission" width="130%">
</figure>
]

.pull-right[
<figure>
  <img src="img/03/mpa-mission@4x.png" alt="MPA mission" title="MPA mission" width="100%">
</figure>
]

???

Inputs:

- Students
- Curriculum
- Money (grants, tuition)
- AYSPS itself
- Faculty, staff
- Technology (iCollege, PAWS)
- Infrastructure
- Transportation
- State regulations
- National accreditation standards
- Faculty research

Activities:

- Classes
- Group work
- Exams
- Internships
- Job fairs
- Commencement
- Studying
- Tutoring
- Office hours
- Advising
- Attendance

Outputs:

- Assignments and projects
- Grades
- Degree
- Jobs
- Awards
- Network
- Debt

Outcomes:

- Leadership
- AYS national ranking
- Public service motivation
- Critical thinking
- Efficient workforce
- Income
- Better society

---

layout: true
class: middle

---

.box-1.medium[Isn't it best to always<br>have an articulated theory?] 

.box-1.medium[Should implicit theory and articulated theory<br>be the same thing in most cases?]

---

.box-1.medium[How much does this evaluation stuff cost?] 

.box-1.medium[Can you do scaled-down versions<br>of these evaluations?]

---

.box-1.medium[What if a program exists already<br>and doesn't have a logic model?] 

.box-1.medium[What if a program exists already and doesn't have baseline data (or any data!)?]

---

.box-1.large[What about stakeholders, politicians,<br>and other decision makers?]

---

.box-1.medium[What should you do if you find that your theory of change (or logic model in general) is wrong in the middle of the program? Is it ethical to stop or readjust?]

---

layout: true
class: title title-1

---

# Outcomes and programs

.box-1.medium[Outcome variable]

.box-inv-1.sp-after-half.SMALL[Thing you're measuring]

--

.box-1.medium[Outcome change]

.box-inv-1.sp-after-half.SMALL[∆ in thing you're measuring over time]

--

.box-1.medium[Program effect]

.box-inv-1.SMALL[∆ in thing you're measuring over time *because of* the program]

---

# Outcomes and programs

<figure>
  <img src="img/04/program-effect.png" alt="Outcomes and program effect" title="Outcomes and program effect" width="100%">
</figure>

---

layout: false
name: dags
class: center middle section-title section-title-5 animated fadeIn

# DAGs

---

layout: true
class: middle

---

.box-5.medium[You keep saying that causal inference<br>lets you "legally" make causal claims.]

.box-5.medium[Are there actual legal consequences<br>if you make a causal claim without<br>specific language?]

---

.box-5.large[Causal thinking is necessary—<br>even for descriptive work!]

---

.center[

<figure>
  <img src="img/04-class/supercentenarians.png" alt="Supercentenarians" title="Supercentenarians" width="46%">
</figure>

]

???

Necessity of causal thinking: Mention the McElreath tweet on birth certificate introduction and death ages: <https://twitter.com/rlmcelreath/status/1427564280744976384>

<https://www.biorxiv.org/content/10.1101/704080v2>

---

layout: false

.box-5.less-medium["Every time I get a haircut, I become more mature!"]

<figure>
  <img src="img/04-class/ben-hair.jpg" alt="Benjamin haircut" title="Benjamin haircut" width="100%">
</figure>

---

.box-5.less-medium["Every time I get a haircut, I become more mature!"]

```{r echo=FALSE, fig.width=5, fig.height=2, out.width="70%", fig.align="center"}
set.seed(1234)
dagify(
  Y ~ X,
  coords = list(x = c(X = 1, Y = 3),
                y = c(X = 1, Y = 1)),
  exposure = "X",
  outcome = "Y",
  labels = c("X" = "Haircut", "Y" = "Maturity")
) %>% 
  tidy_dagitty() %>% 
  node_status() %>% 
  ggplot(aes(x = x, y = y, xend = xend, yend = yend)) +
  geom_dag_edges() +
  geom_dag_point(aes(color = status), size = 15) +
  geom_dag_text(color = "white", size = 5) +
  geom_dag_text(aes(label = label), nudge_y = 0.1, 
                size = 5, color = "black") +
  scale_color_manual(values = c("#FF4136", "#0074D9"),
                     na.value = "#7FDBFF") +
  coord_cartesian(ylim = c(0.9, 1.2)) +
  guides(color = "none") +
  theme_dag()
```

.center[$$E[\text{Maturity} \mid \operatorname{do} (\text{Get haircut})]$$]

---

.box-5.less-medium[Getting older opens a backdoor path]

```{r echo=FALSE, fig.width=5, fig.height=3, out.width="70%", fig.align="center"}
dagify(
  Y ~ X + Z,
  X ~ Z,
  coords = list(x = c(X = 1, Y = 3, Z = 2),
                y = c(X = 1, Y = 1, Z = 2)),
  exposure = "X",
  outcome = "Y",
  labels = c("X" = "Haircut", "Y" = "Maturity",
             "Z" = "Getting older")
) %>% 
  tidy_dagitty() %>% 
  node_status() %>% 
  ggplot(aes(x = x, y = y, xend = xend, yend = yend)) +
  geom_dag_edges() +
  geom_dag_point(aes(color = status), size = 15) +
  geom_dag_text(color = "white", size = 5) +
  geom_dag_text(aes(label = label), nudge_y = 0.25, 
                size = 5, color = "black") +
  scale_color_manual(values = c("#FF4136", "#0074D9"),
                     na.value = "#7FDBFF") +
  coord_cartesian(ylim = c(0.9, 2.2)) +
  guides(color = "none") +
  theme_dag()
```

---

.box-5.less-medium[How do I know which of these is which?]

.pull-left-3[
.box-5.medium[Confounding]

```{r confounding-dag, echo=FALSE, fig.width=4.5, fig.height=3.35, out.width="100%"}
dagify(
  Y ~ X + Z,
  X ~ Z,
  coords = list(x = c(X = 1, Y = 3, Z = 2),
                y = c(X = 1, Y = 1, Z = 2))
) %>% 
  ggplot(aes(x = x, y = y, xend = xend, yend = yend)) +
  geom_dag_edges() +
  geom_dag_point(color = "grey80", size = 17) +
  geom_dag_text(color = "black", size = 5) +
  theme_dag()
```

.box-inv-5.small[Common cause]
]

.pull-middle-3.center[
.box-5.medium[Causation]

```{r mediation-dag, echo=FALSE, fig.width=4.5, fig.height=3.35, out.width="100%"}
dagify(
  Y ~ X + Z,
  Z ~ X,
  coords = list(x = c(X = 1, Y = 3, Z = 2),
                y = c(X = 1, Y = 1, Z = 2))
) %>% 
  ggplot(aes(x = x, y = y, xend = xend, yend = yend)) +
  geom_dag_edges() +
  geom_dag_point(color = "grey80", size = 17) +
  geom_dag_text(color = "black", size = 5) +
  theme_dag()
```

.box-inv-5.small[Mediation]
]

.pull-right-3[
.box-5.medium[Collision]

```{r collision-dag, echo=FALSE, fig.width=4.5, fig.height=3.35, out.width="100%"}
dagify(
  Y ~ X,
  Z ~ Y,
  Z ~ X,
  coords = list(x = c(X = 1, Y = 3, Z = 2),
                y = c(X = 1, Y = 1, Z = 2))
) %>% 
  ggplot(aes(x = x, y = y, xend = xend, yend = yend)) +
  geom_dag_edges() +
  geom_dag_point(color = "grey80", size = 17) +
  geom_dag_text(color = "black", size = 5) +
  theme_dag()
```

.box-inv-5.small[Selection /<br>endogeneity]
]

---

class: middle

.box-5.medium[But what does that mean,<br>"opening a backdoor path"?]

.box-5.medium[How does statistical association<br>get passed through paths?]

---

class: middle

.pull-left[
<figure>
  <img src="img/04-class/slider-switch-plain-80.jpg" alt="Switch and slider" title="Switch and slider" width="100%">
</figure>
]

.pull-right[
```{r confounding-dag-alone, echo=FALSE, fig.width=4.5, fig.height=3.35, out.width="100%"}
dagify(
  Y ~ X + Z,
  X ~ Z,
  coords = list(x = c(X = 1, Y = 3, Z = 2),
                y = c(X = 1, Y = 1, Z = 2))
) %>% 
  ggplot(aes(x = x, y = y, xend = xend, yend = yend)) +
  geom_dag_edges() +
  geom_dag_point(color = "grey80", size = 17) +
  geom_dag_text(color = "black", size = 5) +
  theme_dag()
```
]

---

class: middle

.pull-left[
<figure>
  <img src="img/04-class/slider-switch-plain-80.jpg" alt="Switch and slider" title="Switch and slider" width="100%">
</figure>
]

.pull-right[
```{r mediating-dag-alone, echo=FALSE, fig.width=4.5, fig.height=3.35, out.width="100%"}
dagify(
  Y ~ X + Z,
  Z ~ X,
  coords = list(x = c(X = 1, Y = 3, Z = 2),
                y = c(X = 1, Y = 1, Z = 2))
) %>% 
  ggplot(aes(x = x, y = y, xend = xend, yend = yend)) +
  geom_dag_edges() +
  geom_dag_point(color = "grey80", size = 17) +
  geom_dag_text(color = "black", size = 5) +
  theme_dag()
```
]

---

class: middle

.pull-left[
<figure>
  <img src="img/04-class/slider-switch-plain-80.jpg" alt="Switch and slider" title="Switch and slider" width="100%">
</figure>
]

.pull-right[
```{r colliding-dag-alone, echo=FALSE, fig.width=4.5, fig.height=3.35, out.width="100%"}
dagify(
  Y ~ X,
  Z ~ Y,
  Z ~ X,
  coords = list(x = c(X = 1, Y = 3, Z = 2),
                y = c(X = 1, Y = 1, Z = 2))
) %>% 
  ggplot(aes(x = x, y = y, xend = xend, yend = yend)) +
  geom_dag_edges() +
  geom_dag_point(color = "grey80", size = 17) +
  geom_dag_text(color = "black", size = 5) +
  theme_dag()
```
]

---

layout: true
class: middle

---

.box-5.large[How do we actually<br>adjust for these things?]

---

.box-5.medium[How can you be sure<br>you include everything in a DAG?]

.box-5.medium[Is there a rule of thumb<br>for the number of nodes?]

---

.box-5.large[How exactly do colliders<br>mess up your results?]

.box-5.medium[It looks like you can<br>still get the effect of X on Y]

---

```{r nba-dag, echo=FALSE, fig.width=5, fig.height=3, out.width="65%"}
set.seed(1234)
dagify(
  Y ~ X,
  Z ~ Y,
  Z ~ X,
  coords = list(x = c(X = 1, Y = 3, Z = 2),
                y = c(X = 1, Y = 1, Z = 2)),
  exposure = "X",
  outcome = "Y",
  labels = c("X" = "Height", "Y" = "Points",
             "Z" = "Being in the NBA")
) %>% 
  tidy_dagitty() %>% 
  node_status() %>% 
  ggplot(aes(x = x, y = y, xend = xend, yend = yend)) +
  geom_dag_edges() +
  geom_dag_point(aes(color = status), size = 15) +
  geom_dag_text(color = "white", size = 5) +
  geom_dag_text(aes(label = label), nudge_y = c(0.25, 0.25, -0.25), color = "black", size = 5) +
  scale_color_manual(values = c("#FF4136", "#0074D9"),
                     na.value = "#7FDBFF") +
  guides(color = "none") +
  theme_dag()
```

---

.center[
<figure>
  <img src="img/04-class/facebook.png" alt="Facebook collider" title="Facebook collider" width="55%">
</figure>
]

???

<https://www.businessinsider.com/facebook-sent-incomplete-misinformation-data-flawed-researchers-2021-9>

<https://www.nytimes.com/live/2020/2020-election-misinformation-distortions#facebook-sent-flawed-data-to-misinformation-researchers>

---

layout: true
class: middle

---

.box-5.medium[Why do DAGs have to be acyclic?]

.box-5.medium[What if there really is reverse causation?]

---

.box-5.large[What's the difference between<br>logic models and DAGs?]

.box-inv-5[Can't I just remake my logic model in Dagitty and be done?]

---

layout: false
class: title title-5

# DAGs vs. Logic models

.box-5.large[DAGs are a *statistical* tool]

.box-inv-5[Describe a data-generating process<br>and isolate/identify relationships]

--

.box-5.large.sp-before[Logic models are a *managerial* tool]

.box-inv-5[Oversee the inner workings of a program and its theory]

---

class: middle

.pull-left[
<figure>
  <img src="img/04-class/greenspace-eater.png" alt="Green space in Berkeley" title="Green space in Berkeley" width="100%">
</figure>
]

.pull-right[
<figure>
  <img src="img/04-class/greenspace-conversation.png" alt="Covid green spaces" title="Covid green spaces" width="100%">
</figure>
]

???

<https://theconversation.com/how-cities-can-add-accessible-green-space-in-a-post-coronavirus-world-139194>

<https://sf.eater.com/2020/5/14/21258980/berkeley-coronavirus-covid-19-jesse-arreguin-street-closures>
